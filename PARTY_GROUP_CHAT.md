# 🎉 Party Group Chat Feature

## ฟีเจอร์ที่เพิ่มใหม่

### 1. **แชทกลุ่มก๊วน**
- ทุกคนที่เข้ามาดูรายละเอียดก๊วนสามารถแชทได้
- แชทแบบ realtime อัปเดตทันที
- UI แชทสวยงามคล้าย LINE/WhatsApp
- แสดงรูปโปรไฟล์และชื่อผู้ส่ง

### 2. **ระบบแจ้งเตือนข้อความยังไม่อ่าน**
- มีจุดสีแดงแสดงจำนวนข้อความที่ยังไม่อ่าน  ที่ปุ่มแชทกลุ่ม
- เมื่อเข้าไปอ่านแล้วจุดแดงจะหายไป
- อัปเดตแบบ realtime

### 3. **Auto-delete**
- แชทกลุ่มจะถูกลบอัตโนมัติเมื่อลบก๊วน (CASCADE)

---

## 📋 ขั้นตอนติดตั้ง

### 1. รัน SQL Scripts ใน Supabase

ไปที่ **Supabase Dashboard** → **SQL Editor** แล้วรันตามลำดับ:

#### Script 1: สร้างตาราง party_chats
```sql
-- คัดลอกจากไฟล์ scripts/016_create_party_chats.sql
```

#### Script 2: สร้างระบบติดตามการอ่าน
```sql
-- คัดลอกจากไฟล์ scripts/017_party_chat_reads.sql
```

### 2. Refresh หน้าเว็บ

หลังจากรัน SQL แล้ว ให้ Refresh หน้าเว็บ

---

## 🎯 วิธีใช้งาน

1. **เข้าไปดูรายละเอียดก๊วน**
2. **กดปุ่ม "แชทกลุ่ม"** ด้านล่าง (ถ้ามีข้อความใหม่จะมีจุดแดง)
3. **พิมพ์ข้อความและส่ง** (กด Enter หรือปุ่มส่ง)
4. **ทุกคนในกลุ่มจะเห็นข้อความแบบ realtime**

---

## ✨ Features

- ✅ แชท realtime
- ✅ จุดแดงแจ้งเตือนข้อความยังไม่อ่าน
- ✅ แสดงจำนวนข้อความที่ยังไม่อ่าน (1-9+)
- ✅ Auto-scroll ไปข้อความล่าสุด
- ✅ ส่งด้วย Enter key
- ✅ แสดงเวลาของแต่ละข้อความ
- ✅ Avatar และชื่อผู้ส่ง
- ✅ ลบแชทอัตโนมัติเมื่อลบก๊วน

---

## 🗄️ Database Schema

### Tables Created:
1. **party_chats** - เก็บข้อความแชทกลุ่ม
2. **party_chat_reads** - ติดตามว่าใครอ่านถึงไหนแล้ว

### RPC Function:
- `get_party_unread_count(p_party_id, p_user_id)` - นับข้อความที่ยังไม่อ่าน

---

## 📱 Screenshots

```
┌─────────────────────────┐
│  แชทกลุ่ม: ก๊วนของฉัน  │
├─────────────────────────┤
│                         │
│   👤 John: สวัสดีครับ   │
│   12:30                 │
│                         │
│        ไปกี่โมงครับ 👤  │
│                   13:00 │
│                         │
│   👤 Jane: 18:00 นะคะ   │
│   13:05                 │
│                         │
└─────────────────────────┘
│  พิมพ์ข้อความ...   [ส่ง]│
└─────────────────────────┘
```

---

## 🔧 Files Modified/Created

### Created:
- `app/party/[id]/chat/page.tsx` - หน้าแชทกลุ่ม
- `scripts/016_create_party_chats.sql` - Database schema
- `scripts/017_party_chat_reads.sql` - Read tracking system

### Modified:
- `app/party/[id]/page.tsx` - เพิ่มปุ่มแชทกลุ่มและ badge
- `components/icons.tsx` - เพิ่ม send icon (มีอยู่แล้ว)
